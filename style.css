<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>لوحة التحكم - بوابة الشكاوي</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- عناصر الخلفية المتحركة -->
    <div class="floating-elements">
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>

    <div class="settings-panel">
        <button class="settings-btn" onclick="toggleSettings()">
            <i class="fas fa-cog fa-spin"></i>
            <div class="btn-glow"></div>
        </button>
        <div class="settings-menu glass-effect" id="settings-menu">
            <div class="settings-menu-header">
                <i class="fas fa-sliders-h"></i>
                <h4>إعدادات بوابة الشكاوي</h4>
            </div>
            
            <!-- إعدادات الشعار -->
            <div class="settings-section">
                <h5><i class="fas fa-image"></i> إعدادات الشعار</h5>
                <div class="input-group">
                    <label>رابط الشعار (URL)</label>
                    <input type="url" id="logo-url" class="neon-border" placeholder="https://example.com/logo.png" onchange="autoSaveSettings()" onkeyup="autoSaveSettings()">
                </div>
            </div>

            <!-- إعدادات موقع الخدمات -->
            <div class="settings-section">
                <h5><i class="fas fa-globe"></i> موقع تقديم الخدمات</h5>
                <div class="input-group">
                    <label>رابط الموقع</label>
                    <input type="url" id="services-url" class="neon-border" placeholder="https://example.com/services" onchange="autoSaveSettings()" onkeyup="autoSaveSettings()">
                </div>
                <div class="input-group">
                    <label>نص الزر</label>
                    <input type="text" id="services-text" class="neon-border" placeholder="موقع تقديم خدمات النقابة" onchange="autoSaveSettings()" onkeyup="autoSaveSettings()">
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="show-services-btn" onchange="autoSaveSettings()"> 
                        <span>إظهار الزر في شاشة تقديم الطلبات</span>
                    </label>
                </div>
            </div>

            <!-- إعدادات الترقيم -->
            <div class="settings-section">
                <h5><i class="fas fa-sort-numeric-up"></i> إعدادات الترقيم</h5>
                <div class="input-group">
                    <label>بادئة الشكاوى</label>
                    <input type="text" id="complaint-prefix" class="neon-border" value="REQ" onchange="autoSaveSettings()" onkeyup="autoSaveSettings()">
                </div>
                <div class="input-group">
                    <label>بادئة المقترحات</label>
                    <input type="text" id="suggestion-prefix" class="neon-border" value="REP" onchange="autoSaveSettings()" onkeyup="autoSaveSettings()">
                </div>
            </div>

            <!-- زر تهيئة النظام -->
            <div class="settings-section" id="reset-system-section">
                <h5 style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> تهيئة النظام</h5>
                <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 10px;">هذا الزر يحذف جميع البيانات ويبدأ الترقيم من 1</p>
                <button class="btn-nav" onclick="resetSystem()" style="width:100%; background: var(--danger); color: white;" id="reset-system-btn">
                    <i class="fas fa-trash-alt"></i> تهيئة النظام وبداية جديدة
                </button>
            </div>

            <!-- رسالة تأكيد الحفظ التلقائي -->
            <div class="auto-save-message" id="auto-save-message" style="display: none;">
                <i class="fas fa-check-circle" style="color: var(--success);"></i>
                <span>تم الحفظ تلقائياً</span>
            </div>
        </div>
    </div>

    <aside class="admin-sidebar glass-effect">
        <div class="admin-sidebar-header">
            <div class="admin-logo-container">
                <img src="https://via.placeholder.com/100x100?text=Logo" alt="شعار النقابة" id="admin-logo" class="admin-logo">
                <div class="admin-logo-glow"></div>
            </div>
            <h2>بوابة الشكاوي</h2>
            <p class="admin-subtitle">نقابة تكنولوجيا المعلومات والبرمجيات</p>
        </div>
        
        <nav class="admin-nav">
            <button class="btn-nav admin-nav-btn active" onclick="loadData('all')" id="nav-all">
                <i class="fas fa-list"></i> 
                <span>كل الطلبات</span>
                <div class="btn-glow"></div>
            </button>
            <button class="btn-nav admin-nav-btn" onclick="loadData('شكوى')" id="nav-complaint">
                <i class="fas fa-exclamation-triangle"></i> 
                <span>سجل الشكاوى</span>
                <div class="btn-glow"></div>
            </button>
            <button class="btn-nav admin-nav-btn" onclick="loadData('اقتراح')" id="nav-suggestion">
                <i class="fas fa-lightbulb"></i> 
                <span>سجل المقترحات</span>
                <div class="btn-glow"></div>
            </button>
        </nav>
        
        <button class="btn-main admin-logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> 
            <span>خروج آمن</span>
            <div class="btn-main-glow"></div>
        </button>
    </aside>

    <main class="admin-main">
        <header class="admin-header glass-effect">
            <h1><i class="fas fa-database"></i> سجل الشكاوي والمقترحات</h1>
            <div class="admin-header-actions">
                <button class="btn-nav" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i> تصدير PDF
                </button>
                <button class="btn-nav" onclick="window.print()">
                    <i class="fas fa-print"></i> طباعة
                </button>
            </div>
        </header>

        <!-- شريط البحث المتقدم -->
        <div class="advanced-search glass-effect">
            <div class="search-header" onclick="toggleSearch()">
                <i class="fas fa-search"></i>
                <span>بحث متقدم</span>
                <i class="fas fa-chevron-down" id="search-arrow"></i>
            </div>
            
            <div class="search-body" id="search-body">
                <div class="search-grid">
                    <!-- بحث برقم الشكوى -->
                    <div class="search-field">
                        <label><i class="fas fa-hashtag"></i> رقم الطلب</label>
                        <input type="text" id="search-ref" class="neon-border" placeholder="مثال: REQ-0001-2024" oninput="performSearch()">
                    </div>

                    <!-- بحث بالاسم -->
                    <div class="search-field">
                        <label><i class="fas fa-user"></i> الاسم</label>
                        <input type="text" id="search-name" class="neon-border" placeholder="بحث بالاسم..." oninput="performSearch()">
                    </div>

                    <!-- بحث بالرقم القومي -->
                    <div class="search-field">
                        <label><i class="fas fa-id-card"></i> الرقم القومي</label>
                        <input type="text" id="search-nid" class="neon-border" placeholder="بحث بالرقم القومي..." oninput="performSearch()">
                    </div>

                    <!-- بحث برقم العضوية -->
                    <div class="search-field">
                        <label><i class="fas fa-qrcode"></i> رقم العضوية</label>
                        <input type="text" id="search-member" class="neon-border" placeholder="بحث برقم العضوية..." oninput="performSearch()">
                    </div>

                    <!-- بحث بالتاريخ من -->
                    <div class="search-field">
                        <label><i class="fas fa-calendar"></i> من تاريخ</label>
                        <input type="date" id="search-date-from" class="neon-border" onchange="performSearch()">
                    </div>

                    <!-- بحث بالتاريخ إلى -->
                    <div class="search-field">
                        <label><i class="fas fa-calendar"></i> إلى تاريخ</label>
                        <input type="date" id="search-date-to" class="neon-border" onchange="performSearch()">
                    </div>

                    <!-- تصفية بالنوع -->
                    <div class="search-field">
                        <label><i class="fas fa-tag"></i> نوع الطلب</label>
                        <select id="search-type" class="neon-border" onchange="performSearch()">
                            <option value="all">الكل</option>
                            <option value="شكوى">شكوى</option>
                            <option value="اقتراح">اقتراح</option>
                        </select>
                    </div>

                    <!-- تصفية بالحالة -->
                    <div class="search-field">
                        <label><i class="fas fa-circle"></i> الحالة</label>
                        <select id="search-status" class="neon-border" onchange="performSearch()">
                            <option value="all">الكل</option>
                            <option value="تم الاستلام">تم الاستلام</option>
                            <option value="قيد المراجعة">قيد المراجعة</option>
                            <option value="جاري التنفيذ">جاري التنفيذ</option>
                            <option value="تم الحل">تم الحل</option>
                            <option value="تم الإغلاق النهائي">تم الإغلاق النهائي</option>
                            <option value="تمت القراءة">تمت القراءة</option>
                            <option value="لم يقرأ">لم يقرأ</option>
                        </select>
                    </div>

                    <!-- تصفية بنوع المقدم -->
                    <div class="search-field">
                        <label><i class="fas fa-id-card"></i> نوع المقدم</label>
                        <select id="search-member-type" class="neon-border" onchange="toggleMemberSearch()">
                            <option value="all">الكل</option>
                            <option value="عضو نقابة">عضو نقابة</option>
                            <option value="غير عضو">غير عضو</option>
                        </select>
                    </div>

                    <!-- حقل بحث إضافي لرقم العضوية (يظهر عند اختيار عضو نقابة) -->
                    <div class="search-field" id="member-id-search-field" style="display: none;">
                        <label><i class="fas fa-qrcode"></i> بحث برقم العضوية</label>
                        <input type="text" id="search-specific-member" class="neon-border" placeholder="ادخل رقم العضوية..." oninput="performSearch()">
                    </div>
                </div>

                <div class="search-actions">
                    <button class="btn-nav" onclick="resetSearch()">
                        <i class="fas fa-undo"></i> إعادة ضبط
                    </button>
                    <span class="search-results-count" id="results-count">0 نتيجة</span>
                </div>
            </div>
        </div>

        <div class="admin-table-container glass-effect">
            <div class="table-responsive">
                <table id="main-table">
                    <thead>
                        <tr>
                            <th>التاريخ والوقت</th>
                            <th>رقم الطلب</th>
                            <th>صاحب الطلب</th>
                            <th>نوع العضوية</th>
                            <th>المحافظة</th>
                            <th>النوع</th>
                            <th>الحالة</th>
                            <th>إدارة</th>
                        </tr>
                    </thead>
                    <tbody id="admin-tbody">
                        <tr>
                            <td colspan="8" class="loading-row">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <p>جاري تحميل البيانات...</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- نافذة إدارة الطلب -->
    <div id="request-modal" class="modal" style="z-index: 2000;">
        <div class="modal-content glass-effect">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-content-area" class="modal-scroll"></div>
        </div>
    </div>

    <!-- نافذة الحذف المنفصلة -->
    <div id="delete-modal" class="delete-modal" style="display: none; z-index: 3000;">
        <div class="delete-modal-content glass-effect">
            <h3 style="color: var(--danger); margin-bottom: 15px;">حذف الطلب</h3>
            <input type="password" id="delete-password" class="neon-border" placeholder="كلمة السر" style="width: 100%; margin-bottom: 15px; direction: ltr;">
            <div style="display: flex; gap: 10px;">
                <button class="btn-main" onclick="confirmDelete()" style="background: var(--danger);">تأكيد الحذف</button>
                <button class="btn-nav" onclick="closeDeleteModal()">إلغاء</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="config.js"></script>
    <script src="admin_logic.js"></script>
</body>
</html>
